Bootstrap: docker
From: continuumio/miniconda3

%files
    $PWD/environment.yaml environment.yaml


%post
    chmod 1777 /tmp
    apt-get update && apt-get -y install libgl1
    conda update -n base -c defaults conda -y
    conda env create -f environment.yaml -n peal

    # Source environment at runtime
    echo ". /opt/conda/etc/profile.d/conda.sh" >> $SINGULARITY_ENVIRONMENT
    echo "conda activate peal" >> $SINGULARITY_ENVIRONMENT

